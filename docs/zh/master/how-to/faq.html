<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="icon" href="../_static/favicon.ico">
    <title>常见问题 - GINO 1.1.0b1 文档</title>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async
            src="https://www.googletagmanager.com/gtag/js?id=UA-3759436-10"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag () {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());

        gtag('config', 'UA-3759436-10');
    </script>
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Raleway:400,500,600,700&display=swap">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/@mdi/font@latest/css/materialdesignicons.min.css">
    <link type="text/css" rel="stylesheet"
          href="../_static/css/materialize.min.css"
          media="screen,projection"/>
    <link rel="stylesheet" href="../_static/pygments.css"
          type="text/css"/>
    <link type="text/css" rel="stylesheet"
          href="../_static/css/gino.css"/>
</head>
<body>

<header>
    <div class="navbar-fixed">
        <nav>
            <div class="nav-wrapper">
                <a href="#" data-target="sidenav" class="sidenav-trigger"><hr><hr><hr></a>
                <a href="../index.html" class="brand-logo">
                    <div class="img"
                         style="background-image: url(../_static/logo.svg); width: 103px; height: 40px;"></div>
                </a>
                <div class="breadcrumbs">
                    <a class="breadcrumb" style="display: none"></a>
                    
                        <a href="../how-to.html"
                           class="breadcrumb">进阶用法</a>
                    
                    
                        <a class="breadcrumb" style="color: #FFFFFF">常见问题</a>
                    
                </div>
                <div class="spacer"></div>
                <div id="search-container" class="search">
                    <input type="text" id="search" placeholder="搜索">
                    <i class="mdi mdi-magnify"></i>
                    <div id="search-results" style="display: none"></div>
                </div>
                <a class="btn-flat theme-dark" href="/">
                    首页
                </a>
                <a class="btn-flat theme-dark" href="/authors.html">
                    鸣谢
                </a>
                <a href="https://github.com/python-gino/gino" target="_blank"
                   class="github-stars">
                    <div class="left"><img
                        src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iNDNweCIgaGVpZ2h0PSI0MnB4IiB2aWV3Qm94PSIwIDAgNDMgNDIiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDYxLjIgKDg5NjUzKSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT5GaWxsIDQ5PC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGcgaWQ9IlYzLeacgOaWsOeov+S7tiIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+CiAgICAgICAgPGcgaWQ9IkhPTUUtdjMiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xNTA3LjAwMDAwMCwgLTQ5LjAwMDAwMCkiIGZpbGw9IiNGRkZGRkUiPgogICAgICAgICAgICA8ZyBpZD0iYmFubmVyLWJnIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMzc5LjAwMDAwMCwgLTE4Ny4wMDAwMDApIj4KICAgICAgICAgICAgICAgIDxnIGlkPSJoZWFkZXIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDU5Ny4wMDAwMDAsIDIxOC4wMDAwMDApIj4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTMxMC40OTgwMiwxOCBDMTI5OC42MjcxMiwxOCAxMjg5LDI3LjYzOTg4MzEgMTI4OSwzOS41MzIxMTIzIEMxMjg5LDQ5LjA0NTEwMjYgMTI5NS4xNTk4Myw1Ny4xMTQ2ODggMTMwMy43MDMzNCw1OS45NjE4NDM5IEMxMzA0Ljc3OTAzLDYwLjE2MDExMzggMTMwNS4xNzEwMyw1OS40OTUyNDg3IDEzMDUuMTcxMDMsNTguOTI0MjMxMyBDMTMwNS4xNzEwMyw1OC40MTI2OTUgMTMwNS4xNTI1NSw1Ny4wNTkxNzI0IDEzMDUuMTQxOTksNTUuMjYyODQ3IEMxMjk5LjE2MTY3LDU2LjU2MzQ5NzYgMTI5Ny44OTk4Nyw1Mi4zNzYwMzcxIDEyOTcuODk5ODcsNTIuMzc2MDM3MSBDMTI5Ni45MjE4NSw0OS44ODg0MTA2IDEyOTUuNTEyMjMsNDkuMjI2MTg5MSAxMjk1LjUxMjIzLDQ5LjIyNjE4OTEgQzEyOTMuNTYwMTUsNDcuODkxMTcxNyAxMjk1LjY2MDA2LDQ3LjkxNzYwNzcgMTI5NS42NjAwNiw0Ny45MTc2MDc3IEMxMjk3LjgxODA0LDQ4LjA2OTYxNDYgMTI5OC45NTMxMyw1MC4xMzY5MDg5IDEyOTguOTUzMTMsNTAuMTM2OTA4OSBDMTMwMC44NzA5LDUzLjQyNjg2NzYgMTMwMy45ODU3OSw1Mi40NzY0OTM4IDEzMDUuMjEwNjMsNTEuOTI1MzAzNSBDMTMwNS40MDU5Nyw1MC41MzQ3NzA1IDEzMDUuOTYxNjMsNDkuNTg1NzE4NiAxMzA2LjU3NTM3LDQ5LjA0Nzc0NjIgQzEzMDEuODAxNDEsNDguNTA0NDg2NiAxMjk2Ljc4MTk1LDQ2LjY1NjYxMTEgMTI5Ni43ODE5NSwzOC40MDU5MzkyIEMxMjk2Ljc4MTk1LDM2LjA1NTc3OTkgMTI5Ny42MjAwNiwzNC4xMzI1NjE3IDEyOTguOTk1MzcsMzIuNjI4MzU0IEMxMjk4Ljc3MzYzLDMyLjA4Mzc3MjYgMTI5OC4wMzU4MiwyOS44OTM1NTEgMTI5OS4yMDY1NCwyNi45MzAwNzY4IEMxMjk5LjIwNjU0LDI2LjkzMDA3NjggMTMwMS4wMTA4LDI2LjM1MTEyODYgMTMwNS4xMTgyNCwyOS4xMzc0ODE4IEMxMzA2LjgzMjc1LDI4LjY1ODk5MDQgMTMwOC42NzI2NCwyOC40MjEwNjY1IDEzMTAuNTAwNjYsMjguNDExODEzOSBDMTMxMi4zMjczNiwyOC40MjEwNjY1IDEzMTQuMTY1OTQsMjguNjU4OTkwNCAxMzE1Ljg4MzA4LDI5LjEzNzQ4MTggQzEzMTkuOTg3ODgsMjYuMzUxMTI4NiAxMzIxLjc4OTUsMjYuOTMwMDc2OCAxMzIxLjc4OTUsMjYuOTMwMDc2OCBDMTMyMi45NjI4NiwyOS44OTM1NTEgMTMyMi4yMjUwNSwzMi4wODM3NzI2IDEzMjIuMDA0NjMsMzIuNjI4MzU0IEMxMzIzLjM4MjU4LDM0LjEzMjU2MTcgMTMyNC4yMTQwOSwzNi4wNTU3Nzk5IDEzMjQuMjE0MDksMzguNDA1OTM5MiBDMTMyNC4yMTQwOSw0Ni42Nzc3NTk5IDEzMTkuMTg2NzIsNDguNDk3ODc3NiAxMzE0LjM5ODIzLDQ5LjAzMDU2MjggQzEzMTUuMTY5MDQsNDkuNjk1NDI3OSAxMzE1Ljg1NjY5LDUxLjAwOTI5NjUgMTMxNS44NTY2OSw1My4wMTcxMDk4IEMxMzE1Ljg1NjY5LDU1Ljg5NTk4ODkgMTMxNS44MzAyOSw1OC4yMTgzOTA1IDEzMTUuODMwMjksNTguOTI0MjMxMyBDMTMxNS44MzAyOSw1OS41MDA1MzU5IDEzMTYuMjE4MzMsNjAuMTcwNjg4MiAxMzE3LjMwODU0LDU5Ljk2MDUyMjEgQzEzMjUuODQ1NDUsNTcuMTA2NzU3MiAxMzMyLDQ5LjA0MjQ1OSAxMzMyLDM5LjUzMjExMjMgQzEzMzIsMjcuNjM5ODgzMSAxMzIyLjM3Mjg4LDE4IDEzMTAuNDk4MDIsMTgiIGlkPSJGaWxsLTQ5Ij48L3BhdGg+CiAgICAgICAgICAgICAgICA8L2c+CiAgICAgICAgICAgIDwvZz4KICAgICAgICA8L2c+CiAgICA8L2c+Cjwvc3ZnPg=="
                        class="github-logo">
                        GitHub
                    </div>
                    <div class="right"><img
                        src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMjFweCIgaGVpZ2h0PSIxOXB4IiB2aWV3Qm94PSIwIDAgMjEgMTkiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDYxLjIgKDg5NjUzKSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT5QYXRoPC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGcgaWQ9IlYzLeacgOaWsOeov+S7tiIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+CiAgICAgICAgPGcgaWQ9IkhPTUUtdjMiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xNTYxLjAwMDAwMCwgLTYwLjAwMDAwMCkiIGZpbGw9IiNGOEQyMzAiPgogICAgICAgICAgICA8ZyBpZD0iYmFubmVyLWJnIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMzc5LjAwMDAwMCwgLTE4Ny4wMDAwMDApIj4KICAgICAgICAgICAgICAgIDxnIGlkPSJoZWFkZXIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDU5Ny4wMDAwMDAsIDIxOC4wMDAwMDApIj4KICAgICAgICAgICAgICAgICAgICA8ZyBpZD0ibGFiZWwtY29weS0xMiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTI4OS4wMDAwMDAsIDE4LjAwMDAwMCkiPgogICAgICAgICAgICAgICAgICAgICAgICA8cG9seWdvbiBpZD0iUGF0aCIgcG9pbnRzPSI2MS4wNTQzNTQzIDE3Ljc1NzM4MzYgNTQuMjE1MjQ2NiAxOC4zMTMzOTI5IDU5Ljg4OTM1MTcgMjIuOTczNzM4NyA1Ny43ODQ1MjI4IDI5Ljg0MDExODQgNjQuNDQyNTI3MSAyNi41NDM0MTg4IDcwLjU3NzcyMzkgMjkuODQwMTE4NCA2OS4yMzA0MzI1IDIyLjk3MzczODcgNzQuNzMyNTY5NiAxOC4zMTMzOTI5IDY3Ljg5MzQ2MiAxNy43NTczODM2IDY0LjQ0MjUyNzEgMTEuMzc1Ij48L3BvbHlnb24+CiAgICAgICAgICAgICAgICAgICAgPC9nPgogICAgICAgICAgICAgICAgPC9nPgogICAgICAgICAgICA8L2c+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4=">
                        <span id="github-star-num"></span>
                    </div>
                </a>
            </div>
        </nav>
    </div>

    <div id="sidenav" class="sidenav sidenav-fixed">
        <p class="caption"><span class="caption-text">上手教程</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">上手教程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/announcement.html">官宣：Python 异步编程再添一利器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/tutorial.html">GINO 基础教程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/fastapi.html">搭建一个 FastAPI 服务器</a></li>
</ul>
<p class="caption"><span class="caption-text">进阶用法</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../how-to.html">进阶用法</a></li>
<li class="toctree-l1"><a class="reference internal" href="alembic.html">使用 Alembic</a></li>
<li class="toctree-l1"><a class="reference internal" href="bakery.html">预制查询</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">贡献</a></li>
<li class="toctree-l1"><a class="reference internal" href="crud.html">增删改查</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">常见问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="json-props.html">JSON 扩展属性</a></li>
<li class="toctree-l1"><a class="reference internal" href="loaders.html">加载器与关系</a></li>
<li class="toctree-l1"><a class="reference internal" href="pool.html">连接池</a></li>
<li class="toctree-l1"><a class="reference internal" href="schema.html">表结构定义</a></li>
<li class="toctree-l1"><a class="reference internal" href="transaction.html">数据库事务</a></li>
</ul>
<p class="caption"><span class="caption-text">原理说明</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../explanation.html">原理说明</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanation/async.html">异步编程基础</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanation/engine.html">引擎与连接</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanation/why.html">为什么要用异步 ORM？</a></li>
</ul>
<p class="caption"><span class="caption-text">参考手册</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">参考手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/api.html">API 参考</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/extensions.html">扩展</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/history.html">版本历史</a></li>
</ul>

    </div>
</header>

<main>
    <div class="row">
        <div class="col s12 m9 body">
            <div id="main-content" role="main">
                
    <div class="section" id="frequently-asked-questions">
<h1>常见问题<a class="headerlink" href="#frequently-asked-questions" title="永久链接至标题">¶</a></h1>
<div class="section" id="sqlalchemy-1-4-supports-asyncio-what-will-gino-be">
<h2>SQLAlchemy 1.4 supports asyncio, what will GINO be?<a class="headerlink" href="#sqlalchemy-1-4-supports-asyncio-what-will-gino-be" title="永久链接至标题">¶</a></h2>
<p>Starting from 1.4, SQLAlchemy will <a class="reference external" href="https://docs.sqlalchemy.org/en/14/changelog/migration_14.html#asynchronous-io-support-for-core-and-orm">support asyncio</a>.
This is a great news to the SQLAlchemy-based ORMs including GINO, because the users will
have one more option, and many GINO hacks can be eventually cleaned up. SQLAlchemy
achieved both sync and async API with the same code base by encapsulating the use of
<a class="reference external" href="https://greenlet.readthedocs.io/en/latest/">greenlet</a>. As an &quot;async&quot; user, you don't
need to worry about its internals in most cases, it's fine to just use its async APIs.
Both SQLAlchemy Core and ORM will be async-compatible, but some ORM features that
involve implicit database accesses are disallowed.</p>
<p>Given such news, GINO no longer has to maintain its own asyncpg dialect for SQLAlchemy
in future versions (yay!). Still, GINO will focus on the differences and keep a
compatible API. To list some of the different/future features:</p>
<ul class="simple">
<li><p>Contextual Connections (see <a class="reference internal" href="../explanation/engine.html"><span class="doc">引擎与连接</span></a>)</p></li>
<li><p>SQLAlchemy Core-based CRUD models</p></li>
<li><p>The GINO Loader system</p></li>
<li><p>Async MySQL support</p></li>
<li><p>Typing support <sup>NEW</sup></p></li>
<li><p><a class="reference external" href="https://trio.readthedocs.io/en/stable/">Trio</a> support <sup>NEW</sup></p></li>
<li><p>Execution performance <sup>NEW</sup></p></li>
</ul>
<p>As SQLAlchemy async support is considered in Alpha level, GINO will include SQLAlchemy
1.4 support in GINO 2.0.0-alpha.x releases, while the current GINO 1.0.x and 1.1.x will
remain on SQLAlchemy 1.3. GINO 1.x will receive bug fixes and security updates until
both SQLAlchemy async support and GINO 2.x are stabilized.</p>
</div>
<div class="section" id="orm-or-not-orm">
<h2>ORM or not ORM?<a class="headerlink" href="#orm-or-not-orm" title="永久链接至标题">¶</a></h2>
<p>GINO does perform the Object-Relational Mapping work under the
<a class="reference external" href="https://en.wikipedia.org/wiki/Data_mapper_pattern">Data Mapper Pattern</a>, but
it is just not a traditional ORM. The Objects in GINO are completely stateless
from database - they are pure plain Python objects in memory. Changing their
attribute values does not make them &quot;dirty&quot; - or in a different way of thinking
they are always &quot;dirty&quot;. Any access to database must be explicitly executed.
Using GINO is more like making up SQL clauses with Models and Objects,
executing them to make changes in database, or loading data from database and
wrapping the results with Objects again. Objects are just row data containers,
you are still dealing with SQL which is represented by Models and SQLAlchemy
core grammars. Besides GINO can be used in a completely <a class="reference external" href="schema.html#gino-core">non-ORM way</a>.</p>
</div>
<div class="section" id="can-i-use-features-of-sqlalchemy-orm">
<h2>Can I use features of SQLAlchemy ORM?<a class="headerlink" href="#can-i-use-features-of-sqlalchemy-orm" title="永久链接至标题">¶</a></h2>
<p>SQLAlchemy has <a class="reference external" href="https://docs.sqlalchemy.org/en/13/">two parts</a>:</p>
<ul class="simple">
<li><p>SQLAlchemy Core</p></li>
<li><p>SQLAlchemy ORM</p></li>
</ul>
<p>GINO is built on top of SQLAlchemy Core, so SQLAlchemy ORM won't work in GINO.</p>
</div>
<div class="section" id="how-to-join">
<h2>How to join?<a class="headerlink" href="#how-to-join" title="永久链接至标题">¶</a></h2>
<p>GINO invented none about making up queries, everything for that is inherited
from SQLAlchemy. Therefore you just need to know <a class="reference external" href="https://docs.sqlalchemy.org/en/latest/core/tutorial.html#using-joins">how to write join in
SQLAlchemy</a>.
Especially, <a class="reference external" href="https://github.com/brncsk">Ádám</a> made some amazing upgrades in
GINO <a class="reference external" href="https://github.com/python-gino/gino/pull/113">#113</a> to make join easier, so
that you can use model classes directly as if they are tables in joining:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">User</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">gino</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-connect-to-database-through-ssl">
<h2>How to connect to database through SSL?<a class="headerlink" href="#how-to-connect-to-database-through-ssl" title="永久链接至标题">¶</a></h2>
<p>It depends on the dialect and database driver. For asyncpg, keyword arguments
on <a class="reference external" href="https://magicstack.github.io/asyncpg/current/api/index.html#asyncpg.connection.connect" title="(在 asyncpg v0.21.0)"><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncpg.connect()</span></code></a> are directly
available on <a class="reference internal" href="../reference/api/gino.html#gino.create_engine" title="gino.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a> or <a class="reference internal" href="../reference/api/gino.api.html#gino.api.Gino.set_bind" title="gino.api.Gino.set_bind"><code class="xref py py-meth docutils literal notranslate"><span class="pre">db.set_bind()</span></code></a>. Therefore, enabling SSL is rather easy:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="k">await</span> <span class="n">gino</span><span class="o">.</span><span class="n">create_engine</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">ssl</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="what-is-aiocontextvars-and-what-does-it-do">
<h2>What is aiocontextvars and what does it do?<a class="headerlink" href="#what-is-aiocontextvars-and-what-does-it-do" title="永久链接至标题">¶</a></h2>
<p>It is a partial backport of the new built-in module <a class="reference external" href="https://docs.python.org/3.7/library/contextvars.html">contextvars</a> introduced in Python
3.7. In Python 3.5 and 3.6, <code class="docutils literal notranslate"><span class="pre">aiocontextvars</span></code> patches <code class="docutils literal notranslate"><span class="pre">loop.create_task()</span></code>
to copy context from caller as a workaround to simulate the same behavior. This
is also under discussion in upstream backport project, please read more here:
<a class="reference external" href="https://github.com/MagicStack/contextvars/issues/2">https://github.com/MagicStack/contextvars/issues/2</a></p>
<p>If you are using Python 3.7, then <code class="docutils literal notranslate"><span class="pre">aiocontextvars</span></code> does nothing at all.</p>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>This answer is for GINO 0.8 and later, please check earlier versions of
this documentation if you are using GINO 0.7.</p>
</div>
</div>
<div class="section" id="how-to-define-relationships">
<h2>How to define relationships?<a class="headerlink" href="#how-to-define-relationships" title="永久链接至标题">¶</a></h2>
<p>GINO 1.0 or lower doesn't provide relationship definition feature found in typical ORMs.
However, you could always manually define your tables, design your queries and load the
results explicitly in GINO. Please see <a class="reference internal" href="loaders.html"><span class="doc">加载器与关系</span></a> for more information.</p>
</div>
<div class="section" id="how-to-define-index-with-multiple-columns">
<h2>How to define index with multiple columns?<a class="headerlink" href="#how-to-define-index-with-multiple-columns" title="永久链接至标题">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;users&#39;</span>

    <span class="n">first_name</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Unicode</span><span class="p">())</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Unicode</span><span class="p">())</span>

    <span class="n">_name_idx</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="s1">&#39;index_on_name&#39;</span><span class="p">,</span> <span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;last_name&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">_name_idx</span></code> is not used.</p>
</div>
<div class="section" id="is-there-a-django-admin-interface-for-gino">
<h2>Is there a django admin interface for GINO?<a class="headerlink" href="#is-there-a-django-admin-interface-for-gino" title="永久链接至标题">¶</a></h2>
<p>Not quite yet, please follow <a class="reference external" href="https://github.com/python-gino/gino/issues/260">this discussion</a>.</p>
</div>
<div class="section" id="how-to-use-multiple-databases-for-different-users-on-the-fly">
<h2>How to use multiple databases for different users on the fly?<a class="headerlink" href="#how-to-use-multiple-databases-for-different-users-on-the-fly" title="永久链接至标题">¶</a></h2>
<p>GINO models are linked to a <a class="reference internal" href="../reference/api/gino.api.html#gino.api.Gino" title="gino.api.Gino"><code class="xref py py-class docutils literal notranslate"><span class="pre">Gino</span></code></a> instance, while
<a class="reference internal" href="../reference/api/gino.api.html#gino.api.Gino" title="gino.api.Gino"><code class="xref py py-class docutils literal notranslate"><span class="pre">Gino</span></code></a> has an optional property <code class="docutils literal notranslate"><span class="pre">bind</span></code> to hold a
<a class="reference internal" href="../reference/api/gino.engine.html#gino.engine.GinoEngine" title="gino.engine.GinoEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">GinoEngine</span></code></a> instance. So when you are executing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="k">await</span> <span class="n">User</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">bind</span></code> is implicitly used to execute the query.</p>
<p>In order to use multiple databases, you would need multiple
<a class="reference internal" href="../reference/api/gino.engine.html#gino.engine.GinoEngine" title="gino.engine.GinoEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">GinoEngine</span></code></a> instances. Here's a full example using FastAPI with
lazy engine creation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">asyncio</span> <span class="kn">import</span> <span class="n">Future</span>
<span class="kn">from</span> <span class="nn">contextvars</span> <span class="kn">import</span> <span class="n">ContextVar</span>

<span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span><span class="p">,</span> <span class="n">Request</span>
<span class="kn">from</span> <span class="nn">gino</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="kn">from</span> <span class="nn">gino.ext.starlette</span> <span class="kn">import</span> <span class="n">Gino</span>

<span class="n">engines</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">dbname</span> <span class="o">=</span> <span class="n">ContextVar</span><span class="p">(</span><span class="s2">&quot;dbname&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ContextualGino</span><span class="p">(</span><span class="n">Gino</span><span class="p">):</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">engines</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dbname</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">e</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">done</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bind</span>

    <span class="nd">@bind</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bind</span> <span class="o">=</span> <span class="n">val</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">ContextualGino</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">middleware</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">lazy_engines</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">call_next</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">query_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;db&quot;</span><span class="p">,</span> <span class="s2">&quot;postgres&quot;</span><span class="p">)</span>
    <span class="n">fut</span> <span class="o">=</span> <span class="n">engines</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fut</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fut</span> <span class="o">=</span> <span class="n">engines</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">Future</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">engine</span> <span class="o">=</span> <span class="k">await</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql://localhost/&quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">fut</span><span class="o">.</span><span class="n">set_exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">engines</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">raise</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fut</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">fut</span>
    <span class="n">dbname</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">await</span> <span class="n">call_next</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">get</span><span class="p">():</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dbname</span><span class="o">=</span><span class="k">await</span> <span class="n">db</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="s2">&quot;SELECT current_database()&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-load-complex-query-results">
<h2>How to load complex query results?<a class="headerlink" href="#how-to-load-complex-query-results" title="永久链接至标题">¶</a></h2>
<p>The API doc of <a class="reference internal" href="../reference/api/gino.loader.html#module-gino.loader" title="gino.loader"><code class="xref py py-mod docutils literal notranslate"><span class="pre">gino.loader</span></code></a> explains the available loaders, and there're a few
examples in <a class="reference internal" href="loaders.html"><span class="doc">加载器与关系</span></a> too.</p>
<p>Below is an example with a joined result to load both a GINO model and an integer at the
same time, using a <a class="reference internal" href="../reference/api/gino.loader.html#gino.loader.TupleLoader" title="gino.loader.TupleLoader"><code class="xref py py-class docutils literal notranslate"><span class="pre">TupleLoader</span></code></a> with two sub-loaders -
<a class="reference internal" href="../reference/api/gino.loader.html#gino.loader.ModelLoader" title="gino.loader.ModelLoader"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelLoader</span></code></a> and <a class="reference internal" href="../reference/api/gino.loader.html#gino.loader.ColumnLoader" title="gino.loader.ColumnLoader"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColumnLoader</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">string</span>

<span class="kn">import</span> <span class="nn">gino</span>
<span class="kn">from</span> <span class="nn">gino.loader</span> <span class="kn">import</span> <span class="n">ColumnLoader</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">gino</span><span class="o">.</span><span class="n">Gino</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;users&#39;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">(),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Unicode</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">Visit</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;visits&#39;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">(),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">DateTime</span><span class="p">(),</span> <span class="n">server_default</span><span class="o">=</span><span class="s1">&#39;now()&#39;</span><span class="p">)</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;users.id&#39;</span><span class="p">))</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">with_bind</span><span class="p">(</span><span class="s1">&#39;postgresql://localhost/gino&#39;</span><span class="p">):</span>
        <span class="k">await</span> <span class="n">db</span><span class="o">.</span><span class="n">gino</span><span class="o">.</span><span class="n">create_all</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)):</span>
            <span class="n">u</span> <span class="o">=</span> <span class="k">await</span> <span class="n">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">)):</span>
                <span class="k">await</span> <span class="n">Visit</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="n">visits</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">Visit</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">select</span><span class="p">([</span>
            <span class="n">User</span><span class="p">,</span>
            <span class="n">visits</span><span class="p">,</span>
        <span class="p">])</span><span class="o">.</span><span class="n">select_from</span><span class="p">(</span>
            <span class="n">User</span><span class="o">.</span><span class="n">outerjoin</span><span class="p">(</span><span class="n">Visit</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span>
            <span class="o">*</span><span class="n">User</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">gino</span><span class="o">.</span><span class="n">load</span><span class="p">((</span><span class="n">User</span><span class="p">,</span> <span class="n">ColumnLoader</span><span class="p">(</span><span class="n">visits</span><span class="p">)))</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">transaction</span><span class="p">():</span>
            <span class="k">async</span> <span class="k">for</span> <span class="n">user</span><span class="p">,</span> <span class="n">visits</span> <span class="ow">in</span> <span class="n">q</span><span class="o">.</span><span class="n">iterate</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">visits</span><span class="p">)</span>

        <span class="k">await</span> <span class="n">db</span><span class="o">.</span><span class="n">gino</span><span class="o">.</span><span class="n">drop_all</span><span class="p">()</span>


<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
<p>Be ware of the <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(在 Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a> in <code class="docutils literal notranslate"><span class="pre">.gino.load((...))</span></code>.</p>
</div>
<div class="section" id="how-to-do-bulk-or-batch-insert-update">
<h2>How to do bulk or batch insert / update?<a class="headerlink" href="#how-to-do-bulk-or-batch-insert-update" title="永久链接至标题">¶</a></h2>
<p>For a simple example, take a model that has one field, &quot;name.&quot; In your application you
have a list of names you would like to add to the database:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Austin&quot;</span><span class="p">,</span> <span class="s2">&quot;Ali&quot;</span><span class="p">,</span> <span class="s2">&quot;Jeff&quot;</span><span class="p">,</span> <span class="s2">&quot;Marissa&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>To quickly insert the names in one query, first construct a dict with the
<code class="docutils literal notranslate"><span class="pre">{&quot;model_key&quot;:</span> <span class="pre">&quot;value&quot;}</span></code> format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_names_dict</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">new_name</span><span class="p">)</span> <span class="k">for</span> <span class="n">new_name</span> <span class="ow">in</span> <span class="n">new_names</span><span class="p">]</span>
<span class="o">&gt;&gt;</span> <span class="p">[{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Austin&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Ali&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Jeff&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Marissa&#39;</span><span class="p">}]</span>
</pre></div>
</div>
<p>Finally, run an insert statement on the model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">await</span> <span class="n">User</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span><span class="o">.</span><span class="n">gino</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">new_names_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-print-the-executed-sql">
<h2>How to print the executed SQL?<a class="headerlink" href="#how-to-print-the-executed-sql" title="永久链接至标题">¶</a></h2>
<p>GINO uses the same approach from SQLAlchemy: <code class="docutils literal notranslate"><span class="pre">create_engine(...,</span> <span class="pre">echo=True)</span></code>.
(Or <code class="docutils literal notranslate"><span class="pre">db.set_bind(...,</span> <span class="pre">echo=True)</span></code>) Please see also <a class="reference external" href="https://docs.sqlalchemy.org/en/13/core/engines.html#sqlalchemy.create_engine.params.echo">here</a>.</p>
<p>If you use any extension, you can also set that in config, by <cite>db_echo</cite> or <cite>DB_ECHO</cite>.</p>
</div>
<div class="section" id="how-to-run-exists-sql">
<h2>How to run <code class="docutils literal notranslate"><span class="pre">EXISTS</span></code> SQL?<a class="headerlink" href="#how-to-run-exists-sql" title="永久链接至标题">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">await</span> <span class="n">db</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">email</span> <span class="o">==</span> <span class="n">email</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-work-with-alembic">
<h2>How to work with Alembic?<a class="headerlink" href="#how-to-work-with-alembic" title="永久链接至标题">¶</a></h2>
<p>The fact that <a class="reference internal" href="../reference/api/gino.api.html#gino.api.Gino" title="gino.api.Gino"><code class="xref py py-class docutils literal notranslate"><span class="pre">Gino</span></code></a> is a <a class="reference external" href="https://docs.sqlalchemy.org/en/13/core/metadata.html#sqlalchemy.schema.MetaData" title="(在 SQLAlchemy v1.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetaData</span></code></a> is the
key to use Alembic. Just import and set <code class="docutils literal notranslate"><span class="pre">target_metadata</span> <span class="pre">=</span> <span class="pre">db</span></code> in Alembic <code class="docutils literal notranslate"><span class="pre">env.py</span></code>
will do. See <a class="reference internal" href="alembic.html"><span class="doc">使用 Alembic</span></a> for more details.</p>
</div>
<div class="section" id="how-to-join-the-same-table-twice">
<h2>How to join the same table twice?<a class="headerlink" href="#how-to-join-the-same-table-twice" title="永久链接至标题">¶</a></h2>
<p>This is the same pattern as described in SQLAlchemy <a class="reference external" href="https://docs.sqlalchemy.org/en/13/orm/self_referential.html#self-referential" title="(在 SQLAlchemy v1.3)"><span>Adjacency List Relationships</span></a>, where you
have a table with &quot;a foreign key reference to itself&quot;, or join the same table more than
once, &quot;to represent hierarchical data in flat tables.&quot; We'd need to use
<a class="reference internal" href="../reference/api/gino.crud.html#gino.crud.CRUDModel.alias" title="gino.crud.CRUDModel.alias"><code class="xref py py-func docutils literal notranslate"><span class="pre">alias()</span></code></a>, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;users&quot;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">parent_id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;users.id&quot;</span><span class="p">))</span>

<span class="n">Parent</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">alias</span><span class="p">()</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">outerjoin</span><span class="p">(</span><span class="n">Parent</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">parent_id</span> <span class="o">==</span> <span class="n">Parent</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>
<span class="n">users</span> <span class="o">=</span> <span class="k">await</span> <span class="n">query</span><span class="o">.</span><span class="n">gino</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">Parent</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-execute-raw-sql-with-parameters">
<span id="raw-sql"></span><h2>How to execute raw SQL with parameters?<a class="headerlink" href="#how-to-execute-raw-sql-with-parameters" title="永久链接至标题">¶</a></h2>
<p>Wrap the SQL with <a class="reference external" href="https://docs.sqlalchemy.org/en/13/core/sqlelement.html#sqlalchemy.sql.expression.text" title="(在 SQLAlchemy v1.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">text()</span></code></a>, and use keyword arguments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM users WHERE id = :id_val&#39;</span><span class="p">)</span>
<span class="n">row</span> <span class="o">=</span> <span class="k">await</span> <span class="n">db</span><span class="o">.</span><span class="n">first</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">id_val</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>You may even load the rows into model instances:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">loader</span><span class="o">=</span><span class="n">User</span><span class="p">)</span>
<span class="n">user</span> <span class="o">=</span> <span class="k">await</span> <span class="n">db</span><span class="o">.</span><span class="n">first</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">id_val</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="gino-engine-is-not-initialized">
<h2>Gino engine is not initialized?<a class="headerlink" href="#gino-engine-is-not-initialized" title="永久链接至标题">¶</a></h2>
<p>GINO models are linked to a <a class="reference internal" href="../reference/api/gino.api.html#gino.api.Gino" title="gino.api.Gino"><code class="xref py py-class docutils literal notranslate"><span class="pre">Gino</span></code></a> instance, while
<a class="reference internal" href="../reference/api/gino.api.html#gino.api.Gino" title="gino.api.Gino"><code class="xref py py-class docutils literal notranslate"><span class="pre">Gino</span></code></a> has an optional property <code class="docutils literal notranslate"><span class="pre">bind</span></code> to hold a
<a class="reference internal" href="../reference/api/gino.engine.html#gino.engine.GinoEngine" title="gino.engine.GinoEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">GinoEngine</span></code></a> instance. So when you are executing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="k">await</span> <span class="n">User</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">bind</span></code> is implicitly used to execute the query. If <code class="docutils literal notranslate"><span class="pre">bind</span></code> is not set before
this, you'll see this error:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>gino.exceptions.UninitializedError: Gino engine is not initialized.
</pre></div>
</div>
<p>You could use either:</p>
<ul>
<li><p>Call <a class="reference internal" href="../reference/api/gino.api.html#gino.api.Gino.set_bind" title="gino.api.Gino.set_bind"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_bind()</span></code></a> or <a class="reference internal" href="../reference/api/gino.api.html#gino.api.Gino.with_bind" title="gino.api.Gino.with_bind"><code class="xref py py-meth docutils literal notranslate"><span class="pre">with_bind()</span></code></a> to set the
bind on the <a class="reference internal" href="../reference/api/gino.api.html#gino.api.Gino" title="gino.api.Gino"><code class="xref py py-class docutils literal notranslate"><span class="pre">Gino</span></code></a> instance.</p></li>
<li><p>Use one of the Web framework extensions to set the bind for you in usually the server
start-up hook.</p></li>
<li><p>Use explicit <code class="docutils literal notranslate"><span class="pre">bind</span></code> for each execution, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="k">await</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>
<span class="c1"># ...</span>
<span class="n">user</span> <span class="o">=</span> <span class="k">await</span> <span class="n">User</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="how-can-i-do-sql-xxxx-in-gino">
<h2>How can I do SQL xxxx in GINO?<a class="headerlink" href="#how-can-i-do-sql-xxxx-in-gino" title="永久链接至标题">¶</a></h2>
<p>GINO uses <a class="reference external" href="https://docs.sqlalchemy.org/en/13/core/">SQLAlchemy Core</a> queries, so
please check its documentation on how to build queries. The GINO models are simply
wrappers of SQLAlchemy <a class="reference external" href="https://docs.sqlalchemy.org/en/13/core/metadata.html#sqlalchemy.schema.Table" title="(在 SQLAlchemy v1.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> instances, and the column
attributes on GINO model classes are just SQLAlchemy <a class="reference external" href="https://docs.sqlalchemy.org/en/13/core/metadata.html#sqlalchemy.schema.Column" title="(在 SQLAlchemy v1.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a>
instances, you can use them in building your SQLAlchemy Core queries.</p>
<p>Alternatively, you could always execute the raw SQL directly, see <a class="reference internal" href="#raw-sql"><span class="std std-ref">How to execute raw SQL with parameters?</span></a> above.</p>
</div>
</div>


            </div>
            <p style="text-align: center; font-size: 12px;">
                <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
                    <img
                        alt="知识共享许可协议"
                        style="border-width:0"
                        src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
                    />
                </a>
                <br/>
                本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">知识共享署名-相同方式共享 4.0 国际许可协议</a>进行许可。
            </p>
        </div>

        <div class="col hide-on-small-only m3 right-nav">
            <div class="table-of-contents fixed">
                
                    <ul>
<li><a class="reference internal" href="#">常见问题</a><ul>
<li><a class="reference internal" href="#sqlalchemy-1-4-supports-asyncio-what-will-gino-be">SQLAlchemy 1.4 supports asyncio, what will GINO be?</a></li>
<li><a class="reference internal" href="#orm-or-not-orm">ORM or not ORM?</a></li>
<li><a class="reference internal" href="#can-i-use-features-of-sqlalchemy-orm">Can I use features of SQLAlchemy ORM?</a></li>
<li><a class="reference internal" href="#how-to-join">How to join?</a></li>
<li><a class="reference internal" href="#how-to-connect-to-database-through-ssl">How to connect to database through SSL?</a></li>
<li><a class="reference internal" href="#what-is-aiocontextvars-and-what-does-it-do">What is aiocontextvars and what does it do?</a></li>
<li><a class="reference internal" href="#how-to-define-relationships">How to define relationships?</a></li>
<li><a class="reference internal" href="#how-to-define-index-with-multiple-columns">How to define index with multiple columns?</a></li>
<li><a class="reference internal" href="#is-there-a-django-admin-interface-for-gino">Is there a django admin interface for GINO?</a></li>
<li><a class="reference internal" href="#how-to-use-multiple-databases-for-different-users-on-the-fly">How to use multiple databases for different users on the fly?</a></li>
<li><a class="reference internal" href="#how-to-load-complex-query-results">How to load complex query results?</a></li>
<li><a class="reference internal" href="#how-to-do-bulk-or-batch-insert-update">How to do bulk or batch insert / update?</a></li>
<li><a class="reference internal" href="#how-to-print-the-executed-sql">How to print the executed SQL?</a></li>
<li><a class="reference internal" href="#how-to-run-exists-sql">How to run <code class="docutils literal notranslate"><span class="pre">EXISTS</span></code> SQL?</a></li>
<li><a class="reference internal" href="#how-to-work-with-alembic">How to work with Alembic?</a></li>
<li><a class="reference internal" href="#how-to-join-the-same-table-twice">How to join the same table twice?</a></li>
<li><a class="reference internal" href="#how-to-execute-raw-sql-with-parameters">How to execute raw SQL with parameters?</a></li>
<li><a class="reference internal" href="#gino-engine-is-not-initialized">Gino engine is not initialized?</a></li>
<li><a class="reference internal" href="#how-can-i-do-sql-xxxx-in-gino">How can I do SQL xxxx in GINO?</a></li>
</ul>
</li>
</ul>

                
                <div id="version-selector">
                    
                        <hr>
                    
                    
                        <div class="version-warning">
                            
                                您正在浏览 master 分支，该文档可能涉及尚未发布的功能。
                            
                        </div>
                    
                </div>
                <div class="add-your-lang">
                    <a href="https://www.transifex.com/decentfox-studio/gino_1_0/"
                       target="_blank">Add your language here.</a>
                </div>
            </div>
        </div>

    </div>
    <div class="fixed-action-btn click-to-toggle">
        <a class="btn-floating btn-large white">
            <img src="../_static/images/language.svg">
            <div>
              ZH
            </div>
        </a>
        <ul id="lang-selector">
        </ul>
    </div>
</main>

<script type="text/javascript" src="../_static/js/materialize.min.js"></script>
<script type="text/javascript" src="../_static/js/language_data.js"></script>
<script id="documentation_options" data-url_root="../" src="../_static/js/documentation_options.js"></script>
<script type="text/javascript" src="../_static/js/underscore.js"></script>
<script type="text/javascript" src="../_static/js/jquery.js"></script>
<script type="text/javascript">
    var sver = 'master';
    var language = 'zh';
    var pagename = 'how-to/faq';
</script>
<script type="text/javascript" src="../_static/js/gino.js"></script>
<script type="text/javascript" src="../searchindex.js"></script>
</body>
</html>