<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="icon" href="../_static/favicon.ico">
    <title>Starlette Support - GINO 1.0.0rc1 文档</title>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async
            src="https://www.googletagmanager.com/gtag/js?id=UA-3759436-10"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag () {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());

        gtag('config', 'UA-3759436-10');
    </script>
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/@mdi/font@latest/css/materialdesignicons.min.css">
    <link type="text/css" rel="stylesheet"
          href="../_static/css/materialize.min.css"
          media="screen,projection"/>
    <link rel="stylesheet" href="../_static/pygments.css"
          type="text/css"/>
    <link type="text/css" rel="stylesheet"
          href="../_static/css/gino.css"/>
</head>
<body>

<header>
    <div class="navbar-fixed">
        <nav>
            <div class="nav-wrapper">
                <a href="../index.html" class="brand-logo">
                    <div class="img"
                         style="background-image: url(../_static/logo.png); width: 40px; height: 40px; margin-right: 8px"></div>
                    <div class="img"
                         style="background-image: url(../_static/logo-name.png); width: 100px; height: 32.5px; margin-top: 4px"></div>
                </a>
                <div class="breadcrumbs">
                    <a class="breadcrumb" style="display: none"></a>
                    
                        <a href="../how-to.html"
                           class="breadcrumb">进阶用法</a>
                    
                    
                        <a class="breadcrumb" style="color: #FFFFFF">Starlette Support</a>
                    
                </div>
                <div class="spacer"></div>
                <div class="search">
                    <input type="text" id="search" placeholder="Search">
                    <i class="mdi mdi-magnify"></i>
                </div>
                <a class="waves-effect waves-light btn-flat theme-dark" href="/">
                    <i class="mdi mdi-home"></i>
                    Home
                </a>
                <a class="waves-effect waves-light btn-flat theme-dark"
                   href="/authors.html">
                    <i class="mdi mdi-account-group"></i>
                    Authors
                </a>
                <a href="https://github.com/python-gino/gino" target="_blank"
                   class="github">
                    <i class="mdi mdi-github-circle"></i>
                </a>
            </div>
        </nav>
    </div>

    <div id="sidenav" class="sidenav sidenav-fixed">
        <p class="caption"><span class="caption-text">上手教程</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">上手教程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/tutorial.html">上手教程</a></li>
</ul>
<p class="caption"><span class="caption-text">进阶用法</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../how-to.html">进阶用法</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">贡献</a></li>
<li class="toctree-l1"><a class="reference internal" href="crud.html">CRUD</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="loaders.html">Loaders and Relationship</a></li>
<li class="toctree-l1"><a class="reference internal" href="pool.html">Connection Pool</a></li>
<li class="toctree-l1"><a class="reference internal" href="sanic.html">Sanic Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="schema.html">Schema Declaration</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Starlette Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="tornado.html">Tornado Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="transaction.html">Transaction</a></li>
</ul>
<p class="caption"><span class="caption-text">原理说明</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../explanation.html">原理说明</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanation/engine.html">Engine and Connection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanation/why.html">Why Asynchronous ORM?</a></li>
</ul>
<p class="caption"><span class="caption-text">参考手册</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">参考手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/api.html">API 参考</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/authors.html">制作人员</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/history.html">History</a></li>
</ul>

    </div>
</header>

<main>
    <div class="row">
        <div class="col s12 m9 body">
            
    <div class="section" id="starlette-support">
<h1>Starlette Support<a class="headerlink" href="#starlette-support" title="永久链接至标题">¶</a></h1>
<div class="section" id="work-with-starlette">
<h2>Work with Starlette<a class="headerlink" href="#work-with-starlette" title="永久链接至标题">¶</a></h2>
<p>To use GINO with Starlette, the <a class="reference external" href="https://github.com/python-gino/gino-starlette">gino-starlette</a> package should
be installed first:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">pip install gino-starlette</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>The gino-starlette package supports only GINO 1.0 or later.
Earlier versions of GINO like 0.8.x have built-in Starlette support.</p>
</div>
<p>This extension provides a Starlette middleware to setup and cleanup
database according to the configurations that passed in the <code class="docutils literal notranslate"><span class="pre">kwargs</span></code>
parameter.</p>
<p>The common usage looks like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">starlette.applications</span> <span class="kn">import</span> <span class="n">Starlette</span>
<span class="kn">from</span> <span class="nn">gino.ext.starlette</span> <span class="kn">import</span> <span class="n">Gino</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Starlette</span><span class="p">()</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">Gino</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="c1"># Or with application factory</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Starlette</span><span class="p">()</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">Gino</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="永久链接至标题">¶</a></h2>
<p>The config includes:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 70%" />
<col style="width: 10%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">driver</span></code></p></td>
<td><p>the database driver</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">asyncpg</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">host</span></code></p></td>
<td><p>database server host</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">localhost</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">port</span></code></p></td>
<td><p>database server port</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">5432</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">user</span></code></p></td>
<td><p>database server user</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">postgres</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">password</span></code></p></td>
<td><p>database server password</p></td>
<td><p>empty</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">database</span></code></p></td>
<td><p>database name</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">postgres</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">dsn</span></code></p></td>
<td><p>a SQLAlchemy database URL to create the engine, its existence will replace all previous connect arguments.</p></td>
<td><p>N/A</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">pool_min_size</span></code></p></td>
<td><p>the initial number of connections of the db pool.</p></td>
<td><p>N/A</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">pool_max_size</span></code></p></td>
<td><p>the maximum number of connections in the db pool.</p></td>
<td><p>N/A</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">echo</span></code></p></td>
<td><p>enable SQLAlchemy echo mode.</p></td>
<td><p>N/A</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ssl</span></code></p></td>
<td><p>SSL context passed to <code class="docutils literal notranslate"><span class="pre">asyncpg.connect</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">use_connection_for_request</span></code></p></td>
<td><p>flag to set up lazy connection for requests.</p></td>
<td><p>N/A</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">kwargs</span></code></p></td>
<td><p>other parameters passed to the specified dialects, like <code class="docutils literal notranslate"><span class="pre">asyncpg</span></code>. Unrecognized parameters will cause exceptions.</p></td>
<td><p>N/A</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="lazy-connection">
<h2>Lazy Connection<a class="headerlink" href="#lazy-connection" title="永久链接至标题">¶</a></h2>
<p>If <code class="docutils literal notranslate"><span class="pre">use_connection_for_request</span></code> is set to be True, then a lazy
connection is available at <code class="docutils literal notranslate"><span class="pre">request['connection']</span></code>. By default, a
database connection is borrowed on the first query, shared in the same
execution context, and returned to the pool on response. If you need to
release the connection early in the middle to do some long-running
tasks, you can simply do this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">await</span> <span class="n">request</span><span class="p">[</span><span class="s1">&#39;connection&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">release</span><span class="p">(</span><span class="n">permanent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


        </div>

        <div class="col hide-on-small-only m3 right-nav">
            <div class="table-of-contents fixed">
                
                    <ul>
<li><a class="reference internal" href="#">Starlette Support</a><ul>
<li><a class="reference internal" href="#work-with-starlette">Work with Starlette</a></li>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
<li><a class="reference internal" href="#lazy-connection">Lazy Connection</a></li>
</ul>
</li>
</ul>

                
            </div>
        </div>

    </div>
    <div class="fixed-action-btn click-to-toggle">
        <a class="btn-floating btn-large blue">
            <i class="mdi mdi-translate"></i>
        </a>
        <ul>
            <li><a href="/docs/en/master" class="btn-floating blue">EN</a></li>
            <li><a href="/docs/zh/master" class="btn-floating red">ZH</a></li>
        </ul>
    </div>
</main>

<script type="text/javascript"
        src="../_static/js/materialize.min.js"></script>
<script type="text/javascript"
        src="../_static/js/gino.js"></script>
</body>
</html>