<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="icon" href="../_static/favicon.ico">
    <title>Schema Declaration - GINO 1.0.0a0 文档</title>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async
            src="https://www.googletagmanager.com/gtag/js?id=UA-3759436-10"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag () {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());

        gtag('config', 'UA-3759436-10');
    </script>
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/@mdi/font@latest/css/materialdesignicons.min.css">
    <link type="text/css" rel="stylesheet"
          href="../_static/css/materialize.min.css"
          media="screen,projection"/>
    <link rel="stylesheet" href="../_static/pygments.css"
          type="text/css"/>
    <link type="text/css" rel="stylesheet"
          href="../_static/css/gino.css"/>
</head>
<body>

<header>
    <div class="navbar-fixed">
        <nav>
            <div class="nav-wrapper">
                <a href="../index.html" class="brand-logo">
                    <div class="img"
                         style="background-image: url(../_static/logo.png); width: 40px; height: 40px; margin-right: 8px"></div>
                    <div class="img"
                         style="background-image: url(../_static/logo-name.png); width: 100px; height: 32.5px; margin-top: 4px"></div>
                </a>
                <div class="breadcrumbs">
                    <a class="breadcrumb" style="display: none"></a>
                    
                        <a href="../how-to.html"
                           class="breadcrumb">进阶用法</a>
                    
                    
                        <a class="breadcrumb" style="color: #FFFFFF">Schema Declaration</a>
                    
                </div>
                <div class="spacer"></div>
                <div class="search">
                    <input type="text" id="search" placeholder="Search">
                    <i class="mdi mdi-magnify"></i>
                </div>
                <a class="waves-effect waves-light btn-flat theme-dark" href="/">
                    <i class="mdi mdi-home"></i>
                    Home
                </a>
                <a class="waves-effect waves-light btn-flat theme-dark"
                   href="/authors.html">
                    <i class="mdi mdi-account-group"></i>
                    Authors
                </a>
                <a href="https://github.com/python-gino/gino" target="_blank"
                   class="github">
                    <i class="mdi mdi-github-circle"></i>
                </a>
            </div>
        </nav>
    </div>

    <div id="sidenav" class="sidenav sidenav-fixed">
        <p class="caption"><span class="caption-text">上手教程</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">上手教程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/tutorial.html">上手教程</a></li>
</ul>
<p class="caption"><span class="caption-text">进阶用法</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../how-to.html">进阶用法</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">贡献</a></li>
<li class="toctree-l1"><a class="reference internal" href="crud.html">CRUD</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="loaders.html">Loaders and Relationship</a></li>
<li class="toctree-l1"><a class="reference internal" href="pool.html">Connection Pool</a></li>
<li class="toctree-l1"><a class="reference internal" href="sanic.html">Sanic Support</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Schema Declaration</a></li>
<li class="toctree-l1"><a class="reference internal" href="starlette.html">Starlette Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="tornado.html">Tornado Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="transaction.html">Transaction</a></li>
</ul>
<p class="caption"><span class="caption-text">原理说明</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../explanation.html">原理说明</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanation/engine.html">Engine and Connection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanation/why.html">Why Asynchronous ORM?</a></li>
</ul>
<p class="caption"><span class="caption-text">参考手册</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">参考手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/api.html">API 参考</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/authors.html">制作人员</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/history.html">History</a></li>
</ul>

    </div>
</header>

<main>
    <div class="row">
        <div class="col s12 m9 body">
            
    <div class="section" id="schema-declaration">
<h1>Schema Declaration<a class="headerlink" href="#schema-declaration" title="永久链接至标题">¶</a></h1>
<p>There are 3 ways to declare your database schema to be used with GINO. Because
GINO is built on top of SQLAlchemy core, either way you are actually declaring
SQLAlchemy <a class="reference external" href="https://docs.sqlalchemy.org/en/13/core/metadata.html#sqlalchemy.schema.Table" title="(在 SQLAlchemy v1.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a>.</p>
<div class="section" id="gino-engine">
<h2>GINO Engine<a class="headerlink" href="#gino-engine" title="永久链接至标题">¶</a></h2>
<p>This is the minimized way to use GINO - using only
<a class="reference internal" href="../reference/api/gino.engine.html#gino.engine.GinoEngine" title="gino.engine.GinoEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">GinoEngine</span></code></a> (and <a class="reference internal" href="../reference/api/gino.engine.html#gino.engine.GinoConnection" title="gino.engine.GinoConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">GinoConnection</span></code></a>
too), everything else are vanilla SQLAlchemy core. This is useful when you have
legacy code written in SQLAlchemy core, in need of porting to asyncio. For new
code please use the other two.</p>
<p>For example, the table declaration is the same as SQLAlchemy core <a class="reference external" href="https://docs.sqlalchemy.org/en/latest/core/tutorial.html">tutorial</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">MetaData</span><span class="p">,</span> <span class="n">ForeignKey</span>

<span class="n">metadata</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>

<span class="n">users</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>

    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;fullname&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">addresses</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s1">&#39;addresses&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>

    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;users.id&#39;</span><span class="p">)),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;email_address&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>When using GINO Engine only, it is usually your own business to create the
tables with either <a class="reference external" href="https://docs.sqlalchemy.org/en/13/core/metadata.html#sqlalchemy.schema.MetaData.create_all" title="(在 SQLAlchemy v1.3)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_all()</span></code></a> on a
normal non-async SQLAlchemy engine, or using Alembic. However it is still
possible to be done with GINO if it had to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gino</span>
<span class="kn">from</span> <span class="nn">gino.schema</span> <span class="kn">import</span> <span class="n">GinoSchemaVisitor</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">engine</span> <span class="o">=</span> <span class="k">await</span> <span class="n">gino</span><span class="o">.</span><span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;postgresql://...&#39;</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">GinoSchemaVisitor</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Then, construct queries, in SQLAlchemy core too:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ins</span> <span class="o">=</span> <span class="n">users</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;jack&#39;</span><span class="p">,</span> <span class="n">fullname</span><span class="o">=</span><span class="s1">&#39;Jack Jones&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>So far, everything is still in SQLAlchemy. Now let's get connected and execute
the insert:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">engine</span> <span class="o">=</span> <span class="k">await</span> <span class="n">gino</span><span class="o">.</span><span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;postgresql://localhost/gino&#39;</span><span class="p">)</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="k">await</span> <span class="n">engine</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">conn</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="n">ins</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="k">await</span> <span class="n">conn</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">users</span><span class="o">.</span><span class="n">select</span><span class="p">()))</span>
    <span class="c1"># Outputs: [(1, &#39;jack&#39;, &#39;Jack Jones&#39;)]</span>
</pre></div>
</div>
<p>Here <a class="reference internal" href="../reference/api/gino.html#gino.create_engine" title="gino.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a> creates a <a class="reference internal" href="../reference/api/gino.engine.html#gino.engine.GinoEngine" title="gino.engine.GinoEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">GinoEngine</span></code></a>,
then <a class="reference internal" href="../reference/api/gino.engine.html#gino.engine.GinoEngine.acquire" title="gino.engine.GinoEngine.acquire"><code class="xref py py-meth docutils literal notranslate"><span class="pre">acquire()</span></code></a> checks out a
<a class="reference internal" href="../reference/api/gino.engine.html#gino.engine.GinoConnection" title="gino.engine.GinoConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">GinoConnection</span></code></a>, and
<a class="reference internal" href="../reference/api/gino.engine.html#gino.engine.GinoConnection.status" title="gino.engine.GinoConnection.status"><code class="xref py py-meth docutils literal notranslate"><span class="pre">status()</span></code></a> executes the insert and returns the
status text. This works similarly as SQLAlchemy
<a class="reference external" href="https://docs.sqlalchemy.org/en/13/core/connections.html#sqlalchemy.engine.Connection.execute" title="(在 SQLAlchemy v1.3)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">execute()</span></code></a> - they take the same parameters
but return a bit differently. There are also other similar query APIs:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../reference/api/gino.engine.html#gino.engine.GinoConnection.all" title="gino.engine.GinoConnection.all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">all()</span></code></a> returns a list of
<a class="reference external" href="https://docs.sqlalchemy.org/en/13/core/connections.html#sqlalchemy.engine.RowProxy" title="(在 SQLAlchemy v1.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">RowProxy</span></code></a></p></li>
<li><p><a class="reference internal" href="../reference/api/gino.engine.html#gino.engine.GinoConnection.first" title="gino.engine.GinoConnection.first"><code class="xref py py-meth docutils literal notranslate"><span class="pre">first()</span></code></a> returns one
<a class="reference external" href="https://docs.sqlalchemy.org/en/13/core/connections.html#sqlalchemy.engine.RowProxy" title="(在 SQLAlchemy v1.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">RowProxy</span></code></a>, or <code class="docutils literal notranslate"><span class="pre">None</span></code></p></li>
<li><p><a class="reference internal" href="../reference/api/gino.engine.html#gino.engine.GinoConnection.one" title="gino.engine.GinoConnection.one"><code class="xref py py-meth docutils literal notranslate"><span class="pre">one()</span></code></a> returns one
<a class="reference external" href="https://docs.sqlalchemy.org/en/13/core/connections.html#sqlalchemy.engine.RowProxy" title="(在 SQLAlchemy v1.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">RowProxy</span></code></a></p></li>
<li><p><a class="reference internal" href="../reference/api/gino.engine.html#gino.engine.GinoConnection.one_or_none" title="gino.engine.GinoConnection.one_or_none"><code class="xref py py-meth docutils literal notranslate"><span class="pre">one_or_none()</span></code></a> returns one
<a class="reference external" href="https://docs.sqlalchemy.org/en/13/core/connections.html#sqlalchemy.engine.RowProxy" title="(在 SQLAlchemy v1.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">RowProxy</span></code></a>, or <code class="docutils literal notranslate"><span class="pre">None</span></code></p></li>
<li><p><a class="reference internal" href="../reference/api/gino.engine.html#gino.engine.GinoConnection.scalar" title="gino.engine.GinoConnection.scalar"><code class="xref py py-meth docutils literal notranslate"><span class="pre">scalar()</span></code></a> returns a single value, or
<code class="docutils literal notranslate"><span class="pre">None</span></code></p></li>
<li><p><a class="reference internal" href="../reference/api/gino.engine.html#gino.engine.GinoConnection.iterate" title="gino.engine.GinoConnection.iterate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">iterate()</span></code></a> returns an asynchronous iterator
which yields <a class="reference external" href="https://docs.sqlalchemy.org/en/13/core/connections.html#sqlalchemy.engine.RowProxy" title="(在 SQLAlchemy v1.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">RowProxy</span></code></a></p></li>
</ul>
<p>Please go to their API for more information.</p>
</div>
<div class="section" id="gino-core">
<h2>GINO Core<a class="headerlink" href="#gino-core" title="永久链接至标题">¶</a></h2>
<p>In previous scenario, <a class="reference internal" href="../reference/api/gino.engine.html#gino.engine.GinoEngine" title="gino.engine.GinoEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">GinoEngine</span></code></a> must not be set to
<a class="reference external" href="https://docs.sqlalchemy.org/en/13/core/metadata.html#sqlalchemy.schema.MetaData.bind" title="(在 SQLAlchemy v1.3)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">metadata.bind</span></code></a> because it is not a
regular SQLAlchemy Engine thus it won't work correctly. For this, GINO provides
a subclass of <a class="reference external" href="https://docs.sqlalchemy.org/en/13/core/metadata.html#sqlalchemy.schema.MetaData" title="(在 SQLAlchemy v1.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetaData</span></code></a> as <a class="reference internal" href="../reference/api/gino.api.html#gino.api.Gino" title="gino.api.Gino"><code class="xref py py-class docutils literal notranslate"><span class="pre">Gino</span></code></a>,
usually instantiated globally under the name of <code class="docutils literal notranslate"><span class="pre">db</span></code>. It can be used as a
normal <a class="reference external" href="https://docs.sqlalchemy.org/en/13/core/metadata.html#sqlalchemy.schema.MetaData" title="(在 SQLAlchemy v1.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetaData</span></code></a> still offering some conveniences:</p>
<ul class="simple">
<li><p>It delegates most public types you can access on <code class="docutils literal notranslate"><span class="pre">sqlalchemy</span></code></p></li>
<li><p>It works with both normal SQLAlchemy engine and asynchronous GINO engine</p></li>
<li><p>It exposes all query APIs on <a class="reference internal" href="../reference/api/gino.engine.html#gino.engine.GinoConnection" title="gino.engine.GinoConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">GinoConnection</span></code></a> level</p></li>
<li><p>It injects two <code class="docutils literal notranslate"><span class="pre">gino</span></code> extensions on SQLAlchemy query clauses and schema
items, allowing short inline execution like <code class="docutils literal notranslate"><span class="pre">users.select().gino.all()</span></code></p></li>
<li><p>It is also the entry for the third scenario, see later</p></li>
</ul>
<p>Then we can achieve previous scenario with less code like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gino</span> <span class="kn">import</span> <span class="n">Gino</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">Gino</span><span class="p">()</span>

<span class="n">users</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Table</span><span class="p">(</span>
    <span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span>

    <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">),</span>
    <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s1">&#39;fullname&#39;</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">addresses</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Table</span><span class="p">(</span>
    <span class="s1">&#39;addresses&#39;</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span>

    <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;users.id&#39;</span><span class="p">)),</span>
    <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s1">&#39;email_address&#39;</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">with_bind</span><span class="p">(</span><span class="s1">&#39;postgresql://localhost/gino&#39;</span><span class="p">):</span>
        <span class="k">await</span> <span class="n">db</span><span class="o">.</span><span class="n">gino</span><span class="o">.</span><span class="n">create_all</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">users</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;jack&#39;</span><span class="p">,</span>
            <span class="n">fullname</span><span class="o">=</span><span class="s1">&#39;Jack Jones&#39;</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">gino</span><span class="o">.</span><span class="n">status</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="k">await</span> <span class="n">users</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">gino</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
        <span class="c1"># Outputs: [(1, &#39;jack&#39;, &#39;Jack Jones&#39;)]</span>
</pre></div>
</div>
<p>Similar to SQLAlchemy core and ORM, this is GINO core. All tables and queries
are still made of SQLAlchemy whose rules still apply, but <code class="docutils literal notranslate"><span class="pre">sqlalchemy</span></code> seems
never imported. This is useful when ORM is unwanted.</p>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p><a class="reference external" href="https://github.com/CanopyTax/asyncpgsa/">asyncpgsa</a> does the same thing,
but in a conceptually reversed way - instead of having asyncpg work for
SQLAlchemy, it made SQLAlchemy work for asyncpg (GINO used to be in that
way too because GINO is inspired by asyncpgsa). Either way works fine, it's
just a matter of taste of whose API style to use, SQLAlchemy or asyncpg.</p>
</div>
</div>
<div class="section" id="gino-orm">
<h2>GINO ORM<a class="headerlink" href="#gino-orm" title="永久链接至标题">¶</a></h2>
<p>If you want to further reduce the length of code, and taking a bit risk of
implicity, welcome to the ORM world. Even though GINO made itself not quite a
traditional ORM by being simple and explict to safely work with asyncio, common
ORM concepts are still valid - a table is a model class, a row is a model
instance. Still the same example rewritten in GINO ORM:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gino</span> <span class="kn">import</span> <span class="n">Gino</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">Gino</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;users&#39;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">)</span>
    <span class="n">fullname</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Address</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;addresses&#39;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;users.id&#39;</span><span class="p">))</span>
    <span class="n">email_address</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">with_bind</span><span class="p">(</span><span class="s1">&#39;postgresql://localhost/gino&#39;</span><span class="p">):</span>
        <span class="k">await</span> <span class="n">db</span><span class="o">.</span><span class="n">gino</span><span class="o">.</span><span class="n">create_all</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;jack&#39;</span><span class="p">,</span> <span class="n">fullname</span><span class="o">=</span><span class="s1">&#39;Jack Jones&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="k">await</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">gino</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
        <span class="c1"># Outputs: [&lt;User object at 0x10a8ba860&gt;]</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">重要</p>
<p>The <code class="docutils literal notranslate"><span class="pre">__tablename__</span></code> is a mandatory field to define a concrete model.</p>
</div>
<p>As you can see, the declaration is pretty much the same as before. Underlying
they are identical, declaring two tables in <code class="docutils literal notranslate"><span class="pre">db</span></code>. The <code class="docutils literal notranslate"><span class="pre">class</span></code> style is just
more declarative. Instead of <code class="docutils literal notranslate"><span class="pre">users.c.name</span></code>, you can now access the column by
<code class="docutils literal notranslate"><span class="pre">User.name</span></code>. The implicitly created <a class="reference external" href="https://docs.sqlalchemy.org/en/13/core/metadata.html#sqlalchemy.schema.Table" title="(在 SQLAlchemy v1.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> is
available at <code class="docutils literal notranslate"><span class="pre">User.__table__</span></code> and <code class="docutils literal notranslate"><span class="pre">Address.__table__</span></code>. You can use anything
that works in GINO core here.</p>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>Column names can be different as a class property and database column.
For example, name can be declared as
<code class="docutils literal notranslate"><span class="pre">nickname</span> <span class="pre">=</span> <span class="pre">db.Column('name',</span> <span class="pre">db.Unicode(),</span> <span class="pre">default='noname')</span></code>. In this
example, <code class="docutils literal notranslate"><span class="pre">User.nickname</span></code> is used to access the column, while in database,
the column name is <code class="docutils literal notranslate"><span class="pre">name</span></code>.</p>
<p>What's worth mentioning is where raw SQL statements are used, or
<code class="docutils literal notranslate"><span class="pre">TableClause</span></code> is involved, like <code class="docutils literal notranslate"><span class="pre">User.insert()</span></code>, the original name is
required to be used, because in this case, GINO has no knowledge about the
mappings.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p><code class="docutils literal notranslate"><span class="pre">db.Model</span></code> is a dynamically created parent class for your models. It is
associated with the <code class="docutils literal notranslate"><span class="pre">db</span></code> on initialization, therefore the table is put in
the very <code class="docutils literal notranslate"><span class="pre">db</span></code> when you declare your model class.</p>
</div>
<p>Things become different when it comes to CRUD. You can use model level methods
to directly <a class="reference internal" href="../reference/api/gino.crud.html#gino.crud.CRUDModel.create" title="gino.crud.CRUDModel.create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create()</span></code></a> a model instance, instead of
inserting a new row. Or <a class="reference internal" href="../reference/api/gino.crud.html#gino.crud.CRUDModel.delete" title="gino.crud.CRUDModel.delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">delete()</span></code></a> a model instance
without needing to specify the where clause manually. Query returns model
instances instead of <a class="reference external" href="https://docs.sqlalchemy.org/en/13/core/connections.html#sqlalchemy.engine.RowProxy" title="(在 SQLAlchemy v1.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">RowProxy</span></code></a>, and row values are
directly available as attributes on model instances. See also:
<a class="reference internal" href="crud.html"><span class="doc">CRUD</span></a>.</p>
<p>After all, <a class="reference internal" href="../reference/api/gino.engine.html#gino.engine.GinoEngine" title="gino.engine.GinoEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">GinoEngine</span></code></a> is always in use. Next let's dig
more into it.</p>
</div>
</div>


        </div>

        <div class="col hide-on-small-only m3 right-nav">
            <div class="table-of-contents fixed">
                
                    <ul>
<li><a class="reference internal" href="#">Schema Declaration</a><ul>
<li><a class="reference internal" href="#gino-engine">GINO Engine</a></li>
<li><a class="reference internal" href="#gino-core">GINO Core</a></li>
<li><a class="reference internal" href="#gino-orm">GINO ORM</a></li>
</ul>
</li>
</ul>

                
            </div>
        </div>

    </div>
    <div class="fixed-action-btn click-to-toggle">
        <a class="btn-floating btn-large blue">
            <i class="mdi mdi-translate"></i>
        </a>
        <ul>
            <li><a href="/docs/en/master" class="btn-floating blue">EN</a></li>
            <li><a href="/docs/zh/master" class="btn-floating red">ZH</a></li>
        </ul>
    </div>
</main>

<script type="text/javascript"
        src="../_static/js/materialize.min.js"></script>
<script type="text/javascript"
        src="../_static/js/gino.js"></script>
</body>
</html>