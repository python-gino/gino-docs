<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="icon" href="../_static/favicon.ico">
    <title>Tutorial - GINO 1.0.0rc3 documentation</title>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async
            src="https://www.googletagmanager.com/gtag/js?id=UA-3759436-10"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag () {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());

        gtag('config', 'UA-3759436-10');
    </script>
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/@mdi/font@latest/css/materialdesignicons.min.css">
    <link type="text/css" rel="stylesheet"
          href="../_static/css/materialize.min.css"
          media="screen,projection"/>
    <link rel="stylesheet" href="../_static/pygments.css"
          type="text/css"/>
    <link type="text/css" rel="stylesheet"
          href="../_static/css/gino.css"/>
</head>
<body>

<header>
    <div class="navbar-fixed">
        <nav>
            <div class="nav-wrapper">
                <a href="../index.html" class="brand-logo">
                    <div class="img"
                         style="background-image: url(../_static/logo.png); width: 40px; height: 40px; margin-right: 8px"></div>
                    <div class="img"
                         style="background-image: url(../_static/logo-name.png); width: 100px; height: 32.5px; margin-top: 4px"></div>
                </a>
                <div class="breadcrumbs">
                    <a class="breadcrumb" style="display: none"></a>
                    
                        <a href="../tutorials.html"
                           class="breadcrumb">Tutorials</a>
                    
                    
                        <a class="breadcrumb" style="color: #FFFFFF">Tutorial</a>
                    
                </div>
                <div class="spacer"></div>
                <div class="search">
                    <input type="text" id="search" placeholder="Search">
                    <i class="mdi mdi-magnify"></i>
                </div>
                <a class="waves-effect waves-light btn-flat theme-dark" href="/">
                    <i class="mdi mdi-home"></i>
                    Home
                </a>
                <a class="waves-effect waves-light btn-flat theme-dark"
                   href="/authors.html">
                    <i class="mdi mdi-account-group"></i>
                    Authors
                </a>
                <a href="https://github.com/python-gino/gino" target="_blank"
                   class="github">
                    <i class="mdi mdi-github-circle"></i>
                </a>
            </div>
        </nav>
    </div>

    <div id="sidenav" class="sidenav sidenav-fixed">
        <p class="caption"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Tutorial</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial</a></li>
</ul>
<p class="caption"><span class="caption-text">How-to Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../how-to.html">How-to Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/crud.html">CRUD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/loaders.html">Loaders and Relationship</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/pool.html">Connection Pool</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/sanic.html">Sanic Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/schema.html">Schema Declaration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/starlette.html">Starlette Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/tornado.html">Tornado Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/transaction.html">Transaction</a></li>
</ul>
<p class="caption"><span class="caption-text">Explanation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../explanation.html">Explanation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanation/engine.html">Engine and Connection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanation/why.html">Why Asynchronous ORM?</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/history.html">History</a></li>
</ul>

    </div>
</header>

<main>
    <div class="row">
        <div class="col s12 m9 body">
            
    <div class="section" id="tutorial">
<h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<p>This tutorial helps beginners to get started with the basic part of GINO.
Target audiences of this tutorial should have basic knowledge of:</p>
<ul class="simple">
<li><p>RDBMS, especially <a class="reference external" href="https://www.postgresql.org/">PostgreSQL</a></p></li>
<li><p>Asynchronous programming in Python</p></li>
</ul>
<p>Knowledge of <a class="reference external" href="https://www.sqlalchemy.org/">SQLAlchemy</a> is not required.</p>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Simply speaking, GINO helps you write and execute raw SQL in your asynchronous
application. Instead of interacting RDBMS directly with raw SQL, you can access
your data through friendly objective API.</p>
<p>You may not need GINO, or else to say asynchronous database connection, because
it adds quite some complexity and risk to your stack, and it won’t make your
code run faster, if not slower. Please read <a class="reference internal" href="../explanation/why.html"><span class="doc">Why Asynchronous ORM?</span></a> for more
information.</p>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="stable-release">
<h3>Stable release<a class="headerlink" href="#stable-release" title="Permalink to this headline">¶</a></h3>
<p>To install GINO, run this command in your terminal:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> pip install gino
</pre></div>
</div>
<p>This is the preferred method to install GINO, as it will always install the
most recent stable release.</p>
<p>If you don’t have <a class="reference external" href="https://pip.pypa.io">pip</a> installed, this <a class="reference external" href="http://docs.python-guide.org/en/latest/starting/installation/">Python installation guide</a> can guide
you through the process.</p>
</div>
<div class="section" id="from-sources">
<h3>From sources<a class="headerlink" href="#from-sources" title="Permalink to this headline">¶</a></h3>
<p>The sources for GINO can be downloaded from the <a class="reference external" href="https://github.com/fantix/gino">Github repo</a>.</p>
<p>You can either clone the public repository:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git clone git://github.com/fantix/gino
</pre></div>
</div>
<p>Or download the <a class="reference external" href="https://github.com/fantix/gino/tarball/master">tarball</a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> curl  -OL https://github.com/fantix/gino/tarball/master
</pre></div>
</div>
<p>Once you have a copy of the source, you can install it with:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python setup.py install
</pre></div>
</div>
</div>
</div>
<div class="section" id="declare-models">
<h2>Declare Models<a class="headerlink" href="#declare-models" title="Permalink to this headline">¶</a></h2>
<p>First of all, we’ll need a <a class="reference internal" href="../reference/api/gino.api.html#gino.api.Gino" title="gino.api.Gino"><code class="xref py py-class docutils literal notranslate"><span class="pre">Gino</span></code></a> object, usually under the
name of <code class="docutils literal notranslate"><span class="pre">db</span></code> as a global variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gino</span> <span class="kn">import</span> <span class="n">Gino</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">Gino</span><span class="p">()</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">db</span></code> acts like a reference to the database, most database interactions will
go through it.</p>
<p>“Model” is a basic concept in GINO, it is a Python class inherited from
<a class="reference internal" href="../reference/api/gino.api.html#gino.api.Gino.Model" title="gino.api.Gino.Model"><code class="xref py py-attr docutils literal notranslate"><span class="pre">db.Model</span></code></a>. Each <a class="reference internal" href="../reference/api/gino.declarative.html#gino.declarative.Model" title="gino.declarative.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a>
subclass maps to one table in the database, while each object of the class
represents one row in the table. This must feel familiar if ORM is not a
strange word to you. Now let’s declare a model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;users&#39;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">(),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">nickname</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Unicode</span><span class="p">(),</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;noname&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>By declaring this <code class="docutils literal notranslate"><span class="pre">User</span></code> class, we are actually defining a database table
named <code class="docutils literal notranslate"><span class="pre">users</span></code>, with two columns <code class="docutils literal notranslate"><span class="pre">id</span></code> and <code class="docutils literal notranslate"><span class="pre">nickname</span></code>. Note that the fixed
<code class="xref py py-attr docutils literal notranslate"><span class="pre">__tablename__</span></code> property is required. GINO
suggests singular for model names, and plural for table names. Each
<a class="reference external" href="https://docs.sqlalchemy.org/en/13/core/metadata.html#sqlalchemy.schema.Column" title="(in SQLAlchemy v1.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">db.Column</span></code></a> property defines one column for
the table, where its first parameter indicates the column type in database,
while the rest is for other column attributes or constraints. You can find a
mapping of database types to <code class="docutils literal notranslate"><span class="pre">db</span></code> types <a class="reference external" href="http://docs.sqlalchemy.org/en/latest/core/type_basics.html">here</a> in the SQLAlchemy
documentation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://www.sqlalchemy.org/">SQLAlchemy</a> is a powerful ORM library for non-asynchronous programming in
Python, on top of which GINO is built. SQLAlchemy supports many popular
RDBMS including PostgreSQL and MySQL through different dialect
implementation, so that the same Python code can be compiled into different
SQL depending on the dialect you choose. GINO inherited this support too,
but for now there is only one dialect for PostgreSQL through <a class="reference external" href="https://github.com/MagicStack/asyncpg">asyncpg</a>.</p>
</div>
<p>If you need constraints or indexes covering multiple columns these are also
defined using properties in model classes. The property names must be unique,
but are otherwise not used. Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Booking</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;bookings&#39;</span>

   <span class="n">day</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Date</span><span class="p">)</span>
   <span class="n">booker</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">)</span>
   <span class="n">room</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">)</span>

   <span class="n">_pk</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">PrimaryKeyConstraint</span><span class="p">(</span><span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="s1">&#39;booker&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;bookings_pkey&#39;</span><span class="p">)</span>
   <span class="n">_idx1</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="s1">&#39;bookings_idx_day_room&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="s1">&#39;room&#39;</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
   <span class="n">_idx2</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="s1">&#39;bookings_idx_booker_room&#39;</span><span class="p">,</span> <span class="s1">&#39;booker&#39;</span><span class="p">,</span> <span class="s1">&#39;room&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>It is also possible to define model constraints and indexes outside the model
class if that is preferred. For more details on constraints and indexes, see
<a class="reference external" href="http://docs.sqlalchemy.org/en/latest/core/constraints.html">here</a> in the
SQLAlchemy documentation.</p>
<p>Due to implementation limitations it is currently not allowed to specify
explicit constraints and indexes as direct attributes in classes that are meant
to be subclassed. The same is true for constraints and indexes specified
through the <code class="xref py py-attr docutils literal notranslate"><span class="pre">__table_args__</span></code> attribute. In order
to e.g. define constraints in mixin classes,
<a class="reference internal" href="../reference/api/gino.declarative.html#gino.declarative.declared_attr" title="gino.declarative.declared_attr"><code class="xref py py-func docutils literal notranslate"><span class="pre">declared_attr()</span></code></a> is required. Please feel free to read
more about it in its API documentation.</p>
</div>
<div class="section" id="get-connected">
<h2>Get Connected<a class="headerlink" href="#get-connected" title="Permalink to this headline">¶</a></h2>
<p>The declaration only defined the mapping, it does not create the actual table
in the database. To do that, we need to get connected first. Let’s create a
PostgreSQL database for this tutorial:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> createdb gino
</pre></div>
</div>
<p>Then we tell our <code class="docutils literal notranslate"><span class="pre">db</span></code> object to connect to this database:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">await</span> <span class="n">db</span><span class="o">.</span><span class="n">set_bind</span><span class="p">(</span><span class="s1">&#39;postgresql://localhost/gino&#39;</span><span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
<p>If this runs successfully, then you are connected to the newly created database.
Here <code class="docutils literal notranslate"><span class="pre">postgresql</span></code> indicates the database dialect to use (the default driver
is <code class="docutils literal notranslate"><span class="pre">asyncpg</span></code>, you can explicitly specify that with <code class="docutils literal notranslate"><span class="pre">postgresql+asyncpg://</span></code>,
or simply <code class="docutils literal notranslate"><span class="pre">asyncpg://</span></code>), <code class="docutils literal notranslate"><span class="pre">localhost</span></code> is where the server is, and <code class="docutils literal notranslate"><span class="pre">gino</span></code>
is the name of the database. Check <a class="reference external" href="https://docs.sqlalchemy.org/en/latest/core/engines.html">here</a> for more
information about how to compose this database URL.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Under the hood <a class="reference internal" href="../reference/api/gino.api.html#gino.api.Gino.set_bind" title="gino.api.Gino.set_bind"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_bind()</span></code></a> calls
<a class="reference internal" href="../reference/api/gino.html#gino.create_engine" title="gino.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a> and bind the engine to this <code class="docutils literal notranslate"><span class="pre">db</span></code> object. GINO
engine is similar to SQLAlchemy engine, but not identical. Because GINO
engine is asynchronous, while the other is not. Please refer to the API
reference of GINO for more information.</p>
</div>
<p>Now that we are connected, let’s create the table in database (in the same
<code class="docutils literal notranslate"><span class="pre">main()</span></code> method):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">await</span> <span class="n">db</span><span class="o">.</span><span class="n">gino</span><span class="o">.</span><span class="n">create_all</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>It is <a class="reference internal" href="../reference/api/gino.schema.html#gino.schema.GinoSchemaVisitor.create_all" title="gino.schema.GinoSchemaVisitor.create_all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">db.gino.create_all</span></code></a>,
not <a class="reference external" href="https://docs.sqlalchemy.org/en/13/core/metadata.html#sqlalchemy.schema.MetaData.create_all" title="(in SQLAlchemy v1.3)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">db.create_all</span></code></a>, because
<code class="docutils literal notranslate"><span class="pre">db</span></code> is inherited from SQLAlchemy <a class="reference external" href="https://docs.sqlalchemy.org/en/13/core/metadata.html#sqlalchemy.schema.MetaData" title="(in SQLAlchemy v1.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetaData</span></code></a>,
and <a class="reference external" href="https://docs.sqlalchemy.org/en/13/core/metadata.html#sqlalchemy.schema.MetaData.create_all" title="(in SQLAlchemy v1.3)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">db.create_all</span></code></a> is from
SQLAlchemy using non-asynchronous methods, which doesn’t work with the
bound GINO engine.</p>
<p>In practice <a class="reference internal" href="../reference/api/gino.schema.html#gino.schema.GinoSchemaVisitor.create_all" title="gino.schema.GinoSchemaVisitor.create_all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_all()</span></code></a> is usually
not an ideal solution. To manage database schema, tool like <a class="reference external" href="https://bitbucket.org/zzzeek/alembic">Alembic</a> is
recommended.</p>
</div>
<p>If you want to explicitly disconnect from the database, you can do this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">await</span> <span class="n">db</span><span class="o">.</span><span class="n">pop_bind</span><span class="p">()</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Let’s review the code we have so far together in one piece before moving on:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">from</span> <span class="nn">gino</span> <span class="kn">import</span> <span class="n">Gino</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">Gino</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;users&#39;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">(),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">nickname</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Unicode</span><span class="p">(),</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;noname&#39;</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">await</span> <span class="n">db</span><span class="o">.</span><span class="n">set_bind</span><span class="p">(</span><span class="s1">&#39;postgresql://localhost/gino&#39;</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">db</span><span class="o">.</span><span class="n">gino</span><span class="o">.</span><span class="n">create_all</span><span class="p">()</span>

    <span class="c1"># further code goes here</span>

    <span class="k">await</span> <span class="n">db</span><span class="o">.</span><span class="n">pop_bind</span><span class="p">()</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="crud-operations">
<h2>CRUD Operations<a class="headerlink" href="#crud-operations" title="Permalink to this headline">¶</a></h2>
<p>In order to operate on the database, one of GINO’s core features is to Create,
Retrieve, Update or Delete model objects, also known as the CRUD operations.</p>
<div class="section" id="create">
<h3>Create<a class="headerlink" href="#create" title="Permalink to this headline">¶</a></h3>
<p>Let’s start by creating a <code class="docutils literal notranslate"><span class="pre">User</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="k">await</span> <span class="n">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">nickname</span><span class="o">=</span><span class="s1">&#39;fantix&#39;</span><span class="p">)</span>
<span class="c1"># This will cause GINO to execute this SQL with parameter &#39;fantix&#39;:</span>
<span class="c1"># INSERT INTO users (nickname) VALUES ($1) RETURNING users.id, users.nickname</span>
</pre></div>
</div>
<p>As mentioned previously, <code class="docutils literal notranslate"><span class="pre">user</span></code> object represents the newly created row in
the database. You can get the value of each columns by the declared column
properties on the object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ID:       </span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>           <span class="c1"># 1</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Nickname: </span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">nickname</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>     <span class="c1"># fantix</span>
</pre></div>
</div>
<p>It is also possible to create a model instance in-memory first, modify it, then
finally create it in the database:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">nickname</span><span class="o">=</span><span class="s1">&#39;fantix&#39;</span><span class="p">)</span>
<span class="n">user</span><span class="o">.</span><span class="n">nickname</span> <span class="o">+=</span> <span class="s1">&#39; (founder)&#39;</span>
<span class="k">await</span> <span class="n">user</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="retrieve">
<h3>Retrieve<a class="headerlink" href="#retrieve" title="Permalink to this headline">¶</a></h3>
<p>To retrieve a model object from database by primary key, you can use the class
method <a class="reference internal" href="../reference/api/gino.crud.html#gino.crud.CRUDModel.get" title="gino.crud.CRUDModel.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get()</span></code></a> on the model class. Now let’s retrieve
the same row:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="k">await</span> <span class="n">User</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># SQL (parameter: 1):</span>
<span class="c1"># SELECT users.id, users.nickname FROM users WHERE users.id = $1</span>
</pre></div>
</div>
<p>Normal SQL queries are done through a class property
<a class="reference internal" href="../reference/api/gino.crud.html#gino.crud.CRUDModel.query" title="gino.crud.CRUDModel.query"><code class="xref py py-attr docutils literal notranslate"><span class="pre">query</span></code></a>. For example, let’s retrieve all <code class="docutils literal notranslate"><span class="pre">User</span></code>
objects from database as a list:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">all_users</span> <span class="o">=</span> <span class="k">await</span> <span class="n">db</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="p">)</span>
<span class="c1"># SQL:</span>
<span class="c1"># SELECT users.id, users.nickname FROM users</span>
</pre></div>
</div>
<p>Alternatively, you can use the <code class="docutils literal notranslate"><span class="pre">gino</span></code> extension on
<a class="reference internal" href="../reference/api/gino.crud.html#gino.crud.CRUDModel.query" title="gino.crud.CRUDModel.query"><code class="xref py py-attr docutils literal notranslate"><span class="pre">query</span></code></a>. This has exactly the same effect as above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">all_users</span> <span class="o">=</span> <span class="k">await</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">gino</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="c1"># SQL:</span>
<span class="c1"># SELECT users.id, users.nickname FROM users</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">User.query</span></code> is actually a SQLAlchemy query, with its own
non-asynchronous execution methods. GINO added this <code class="docutils literal notranslate"><span class="pre">gino</span></code> extension on
all executable SQLAlchemy clause objects to conveniently execute them in
the asynchronous way, so that it is even not needed to import the <code class="docutils literal notranslate"><span class="pre">db</span></code>
reference for execution.</p>
</div>
<p>Now let’s add some filters. For example, find all users with ID lower than 10:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">founding_users</span> <span class="o">=</span> <span class="k">await</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">gino</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="c1"># SQL (parameter: 10):</span>
<span class="c1"># SELECT users.id, users.nickname FROM users WHERE users.id &lt; $1</span>
</pre></div>
</div>
<p>Read more <a class="reference external" href="https://docs.sqlalchemy.org/en/latest/core/expression_api.html">here</a>
about writing queries, because the query object is exactly from SQLAlchemy core.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Once you get a model object, it is purely in memory and fully detached from
the database. That means, if the row is externally updated, the object
values remain unchanged. Likewise, changes made to the object won’t affect
the database values.</p>
<p>Also, GINO keeps no track of model objects, therefore getting the same row
twice returns two different object with identical values. Modifying one
does not magically affect the other one.</p>
<p>Different than traditional ORMs, the GINO model objects are more like
objective SQL results, rather than stateful ORM objects. In order to adapt
for asynchronous programming, GINO is designed to be that simple. That’s
also why GINO Is Not ORM.</p>
</div>
<p>Sometimes we want to get only one object, for example getting the user by name
when logging in. There’s a shortcut for this scenario:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="k">await</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">nickname</span> <span class="o">==</span> <span class="s1">&#39;fantix&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">gino</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="c1"># SQL (parameter: &#39;fantix&#39;):</span>
<span class="c1"># SELECT users.id, users.nickname FROM users WHERE users.nickname = $1</span>
</pre></div>
</div>
<p>If there is no user named “fantix” in database, <code class="docutils literal notranslate"><span class="pre">user</span></code> will be <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>And sometimes we may want to get a single value from database, getting the name
of user with ID 1 for example. Then we can use the
<a class="reference internal" href="../reference/api/gino.crud.html#gino.crud.CRUDModel.select" title="gino.crud.CRUDModel.select"><code class="xref py py-meth docutils literal notranslate"><span class="pre">select()</span></code></a> class method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="k">await</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;nickname&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">gino</span><span class="o">.</span><span class="n">scalar</span><span class="p">()</span>
<span class="c1"># SQL (parameter: 1):</span>
<span class="c1"># SELECT users.nickname FROM users WHERE users.id = $1</span>
<span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>  <span class="c1"># fantix</span>
</pre></div>
</div>
<p>Or get the count of all users:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">population</span> <span class="o">=</span> <span class="k">await</span> <span class="n">db</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">gino</span><span class="o">.</span><span class="n">scalar</span><span class="p">()</span>
<span class="c1"># SQL:</span>
<span class="c1"># SELECT count(users.id) AS count_1 FROM users</span>
<span class="nb">print</span><span class="p">(</span><span class="n">population</span><span class="p">)</span>  <span class="c1"># 17 for example</span>
</pre></div>
</div>
</div>
<div class="section" id="update">
<h3>Update<a class="headerlink" href="#update" title="Permalink to this headline">¶</a></h3>
<p>Then let’s try to make some modifications. In this example we’ll mixin some
retrieve operations we just tried.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a new user</span>
<span class="n">user</span> <span class="o">=</span> <span class="k">await</span> <span class="n">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">nickname</span><span class="o">=</span><span class="s1">&#39;fantix&#39;</span><span class="p">)</span>

<span class="c1"># get its name</span>
<span class="n">name</span> <span class="o">=</span> <span class="k">await</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;nickname&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">User</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">gino</span><span class="o">.</span><span class="n">scalar</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">name</span> <span class="o">==</span> <span class="n">user</span><span class="o">.</span><span class="n">nickname</span>  <span class="c1"># they are both &#39;fantix&#39; before the update</span>

<span class="c1"># modification here</span>
<span class="k">await</span> <span class="n">user</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">nickname</span><span class="o">=</span><span class="s1">&#39;daisy&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">()</span>
<span class="c1"># SQL (parameters: &#39;daisy&#39;, 1):</span>
<span class="c1"># UPDATE users SET nickname=$1 WHERE users.id = $2 RETURNING users.nickname</span>
<span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">nickname</span><span class="p">)</span>  <span class="c1"># daisy</span>

<span class="c1"># get its name again</span>
<span class="n">name</span> <span class="o">=</span> <span class="k">await</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;nickname&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">User</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">gino</span><span class="o">.</span><span class="n">scalar</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>  <span class="c1"># daisy</span>
<span class="k">assert</span> <span class="n">name</span> <span class="o">==</span> <span class="n">user</span><span class="o">.</span><span class="n">nickname</span>  <span class="c1"># they are both &#39;daisy&#39; after the update</span>
</pre></div>
</div>
<p>So <a class="reference internal" href="../reference/api/gino.crud.html#gino.crud.CRUDModel.update" title="gino.crud.CRUDModel.update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">update()</span></code></a> is the first GINO method we met so far
on model instance level. It accepts multiple keyword arguments, whose keys are
column names while values are the new value to update to. The following
<a class="reference internal" href="../reference/api/gino.crud.html#gino.crud.UpdateRequest.apply" title="gino.crud.UpdateRequest.apply"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply()</span></code></a> call makes the update happen in database.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>GINO explicitly split the in-memory update and SQL update into two methods:
<a class="reference internal" href="../reference/api/gino.crud.html#gino.crud.CRUDModel.update" title="gino.crud.CRUDModel.update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">update()</span></code></a> and
<a class="reference internal" href="../reference/api/gino.crud.html#gino.crud.UpdateRequest.apply" title="gino.crud.UpdateRequest.apply"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply()</span></code></a>. <a class="reference internal" href="../reference/api/gino.crud.html#gino.crud.CRUDModel.update" title="gino.crud.CRUDModel.update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">update()</span></code></a>
will update the in-memory model object and return an
<a class="reference internal" href="../reference/api/gino.crud.html#gino.crud.UpdateRequest" title="gino.crud.UpdateRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">UpdateRequest</span></code></a> object which contains all the
modifications. A following <a class="reference internal" href="../reference/api/gino.crud.html#gino.crud.UpdateRequest.apply" title="gino.crud.UpdateRequest.apply"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply()</span></code></a> on
<a class="reference internal" href="../reference/api/gino.crud.html#gino.crud.UpdateRequest" title="gino.crud.UpdateRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">UpdateRequest</span></code></a> object will apply these recorded
modifications to database by executing a compiled SQL.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><a class="reference internal" href="../reference/api/gino.crud.html#gino.crud.UpdateRequest" title="gino.crud.UpdateRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">UpdateRequest</span></code></a> object has another method named
<a class="reference internal" href="../reference/api/gino.crud.html#gino.crud.UpdateRequest.update" title="gino.crud.UpdateRequest.update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">update()</span></code></a> which works the same as the one
on model object, just that it combines the new modifications together with
the ones already recorded in current <a class="reference internal" href="../reference/api/gino.crud.html#gino.crud.UpdateRequest" title="gino.crud.UpdateRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">UpdateRequest</span></code></a>
object, and it returns the same <a class="reference internal" href="../reference/api/gino.crud.html#gino.crud.UpdateRequest" title="gino.crud.UpdateRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">UpdateRequest</span></code></a> object.
That means, you can chain the updates and end up with one
<a class="reference internal" href="../reference/api/gino.crud.html#gino.crud.UpdateRequest.apply" title="gino.crud.UpdateRequest.apply"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply()</span></code></a>, or make use of the
<a class="reference internal" href="../reference/api/gino.crud.html#gino.crud.UpdateRequest" title="gino.crud.UpdateRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">UpdateRequest</span></code></a> object to combine several updates in a
batch.</p>
</div>
<p><a class="reference internal" href="../reference/api/gino.crud.html#gino.crud.CRUDModel.update" title="gino.crud.CRUDModel.update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">update()</span></code></a> on model object affects only the row
represented by the object. If you want to do update with wider condition, you
can use the <a class="reference internal" href="../reference/api/gino.crud.html#gino.crud.CRUDModel.update" title="gino.crud.CRUDModel.update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">update()</span></code></a> on model class level, with a
bit difference:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">await</span> <span class="n">User</span><span class="o">.</span><span class="n">update</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">nickname</span><span class="o">=</span><span class="s1">&#39;Founding Member &#39;</span> <span class="o">+</span> <span class="n">User</span><span class="o">.</span><span class="n">nickname</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">User</span><span class="o">.</span><span class="n">id</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">gino</span><span class="o">.</span><span class="n">status</span><span class="p">()</span>
<span class="c1"># SQL (parameter: &#39;Founding Member &#39;, 10):</span>
<span class="c1"># UPDATE users SET nickname=($1 || users.nickname) WHERE users.id &lt; $2</span>

<span class="n">name</span> <span class="o">=</span> <span class="k">await</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;nickname&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">User</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">gino</span><span class="o">.</span><span class="n">scalar</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>  <span class="c1"># Founding Member fantix</span>
</pre></div>
</div>
<p>There is no <a class="reference internal" href="../reference/api/gino.crud.html#gino.crud.UpdateRequest" title="gino.crud.UpdateRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">UpdateRequest</span></code></a> here, everything is again
SQLAlchemy clause, its
<a class="reference external" href="https://docs.sqlalchemy.org/en/latest/core/dml.html">documentation</a> here for
your reference.</p>
</div>
<div class="section" id="delete">
<h3>Delete<a class="headerlink" href="#delete" title="Permalink to this headline">¶</a></h3>
<p>At last. Deleting is similar to updating, but way simpler.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="k">await</span> <span class="n">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">nickname</span><span class="o">=</span><span class="s1">&#39;fantix&#39;</span><span class="p">)</span>
<span class="k">await</span> <span class="n">user</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
<span class="c1"># SQL (parameter: 1):</span>
<span class="c1"># DELETE FROM users WHERE users.id = $1</span>
<span class="nb">print</span><span class="p">(</span><span class="k">await</span> <span class="n">User</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>  <span class="c1"># None</span>
</pre></div>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Remember the model object is in memory? In the last <a class="reference external" href="https://docs.python.org/3/library/functions.html#print" title="(in Python v3.8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">print()</span></code></a>
statement, even though the row is already deleted in database, the object
<code class="docutils literal notranslate"><span class="pre">user</span></code> still exists with its values untouched.</p>
</div>
<p>Or mass deletion (never forget the where clause, unless you want to truncate
the whole table!!):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">await</span> <span class="n">User</span><span class="o">.</span><span class="n">delete</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">gino</span><span class="o">.</span><span class="n">status</span><span class="p">()</span>
<span class="c1"># SQL (parameter: 10):</span>
<span class="c1"># DELETE FROM users WHERE users.id &gt; $1</span>
</pre></div>
</div>
<p>With basic <a class="reference internal" href="../how-to/crud.html"><span class="doc">CRUD</span></a>, you can already make some amazing stuff with
GINO. This tutorial ends here, please find out more in detail from the rest of
this documentation, and have fun hacking!</p>
</div>
</div>
</div>


        </div>

        <div class="col hide-on-small-only m3 right-nav">
            <div class="table-of-contents fixed">
                
                    <ul>
<li><a class="reference internal" href="#">Tutorial</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#installation">Installation</a><ul>
<li><a class="reference internal" href="#stable-release">Stable release</a></li>
<li><a class="reference internal" href="#from-sources">From sources</a></li>
</ul>
</li>
<li><a class="reference internal" href="#declare-models">Declare Models</a></li>
<li><a class="reference internal" href="#get-connected">Get Connected</a></li>
<li><a class="reference internal" href="#crud-operations">CRUD Operations</a><ul>
<li><a class="reference internal" href="#create">Create</a></li>
<li><a class="reference internal" href="#retrieve">Retrieve</a></li>
<li><a class="reference internal" href="#update">Update</a></li>
<li><a class="reference internal" href="#delete">Delete</a></li>
</ul>
</li>
</ul>
</li>
</ul>

                
            </div>
        </div>

    </div>
    <div class="fixed-action-btn click-to-toggle">
        <a class="btn-floating btn-large blue">
            <i class="mdi mdi-translate"></i>
        </a>
        <ul>
            <li><a href="/docs/en/v1.0.0rc3" class="btn-floating blue">EN</a></li>
            <li><a href="/docs/zh/v1.0.0rc3" class="btn-floating red">ZH</a></li>
        </ul>
    </div>
</main>

<script type="text/javascript"
        src="../_static/js/materialize.min.js"></script>
<script type="text/javascript"
        src="../_static/js/gino.js"></script>
</body>
</html>